"use strict";var _createClass=function(){function o(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}!function(){function _(e,t){if(!(e instanceof t))throw new Error("Bound instance method accessed before binding")}jQuery(function(a){var d;return d=window.Checkout_Add_Ons_Meta_Box_Add_On_Data=(_inherits(t,window.Checkout_Add_Ons_Meta_Box),_createClass(t,[{key:"initialize_fields",value:function(){return _(this,d),this.meta_box.find("select[name=type]").on("change",this.add_on_type_changed).trigger("change"),this.meta_box.find(".is_taxable_field input[type=checkbox]").on("change",this.is_taxable_changed).trigger("change")}},{key:"add_on_type_changed",value:function(e){return _(this,d),this.handle_checkbox_default(e.target.value),this.handle_field_exclusions(e.target.value),this.disable_options(),this.params.add_on_types_with_options&&void 0!==this.params.add_on_types_with_options[e.target.value]&&this.enable_options(),this.enable_disable_attributes(),this.is_taxable_changed()}},{key:"handle_field_exclusions",value:function(e){return _(this,d),this.meta_box.find(".form-field").show(),this.meta_box.find(".form-field.exclusive").hide(),this.meta_box.find(".form-field.exclusive_to_"+e).show(),this.meta_box.find(".form-field.exclude_"+e).hide()}},{key:"handle_checkbox_default",value:function(e){var t,i;return _(this,d),t=this.meta_box.find("#default_checkbox_value"),""!==(i=this.meta_box.find("#default_value")).attr("name")&&i.attr("_name",i.attr("name")),"checkbox"===e?(i.attr("name","").val(""),t.attr("name",i.attr("_name"))):(i.attr("name",i.attr("_name")),t.attr("name",""))}},{key:"is_taxable_changed",value:function(){if(_(this,d),this.meta_box.find(".form-field.tax_class_field").hide(),this.meta_box.find(".is_taxable_field input[type=checkbox]").is(":checked"))return this.meta_box.find(".form-field.tax_class_field").show()}},{key:"disable_options",value:function(){return _(this,d),this.meta_box.find(".checkout-add-ons-no-options-allowed").show(),this.meta_box.find(".form-field.default_value_field .default_value-outer").show(),this.meta_box.find(".form-field.default_value_field .woocommerce-help-tip").show(),this.meta_box.find(".form-field.default_value_field .default_value-options-note").hide(),this.meta_box.find(".form-field.adjustment_field .adjustment-outer").show(),this.meta_box.find(".form-field.adjustment_field .woocommerce-help-tip").show(),this.meta_box.find(".form-field.adjustment_field .adjustment-options-note").hide(),this.meta_box.find("li.options_tab").addClass("disabled").tipTip({content:this.params.i18n.disabled_options_tab_note}),this.meta_box.find(".checkout-add-ons-options").hide(),this.meta_box.find(".checkout-add-ons-no-options").hide()}},{key:"enable_options",value:function(){return _(this,d),this.updated_options(),this.meta_box.find(".form-field.default_value_field .default_value-outer").hide(),this.meta_box.find(".form-field.default_value_field .woocommerce-help-tip").hide(),this.meta_box.find(".form-field.default_value_field .default_value-options-note").show(),this.meta_box.find(".form-field.adjustment_field .adjustment-outer").hide(),this.meta_box.find(".form-field.adjustment_field .woocommerce-help-tip").hide(),this.meta_box.find(".form-field.adjustment_field .adjustment-options-note").show(),this.meta_box.find("li.options_tab").removeClass("disabled").unbind("hover"),this.meta_box.find(".checkout-add-ons-options").show(),this.meta_box.find(".checkout-add-ons-no-options-allowed").hide()}},{key:"updated_options",value:function(){var e;return _(this,d),1<this.meta_box.find(".checkout-add-on-option-row").length?(this.meta_box.find(".checkout-add-ons-no-options").hide(),this.meta_box.find("button.js-remove-options").show()):(this.meta_box.find(".checkout-add-ons-no-options").show(),this.meta_box.find("button.js-remove-options").hide()),e=this.meta_box.find("select[name=type]").val(),this.params.add_on_types_with_options&&this.params.add_on_types_with_options[e]&&this.params.add_on_types_with_options[e].multiple_defaults?(this.meta_box.find(".checkout-add-on-option-field.default-field").hide(),this.meta_box.find(".checkout-add-on-option-field.multi-default-field").show()):(this.meta_box.find(".checkout-add-on-option-field.default-field").show(),this.meta_box.find(".checkout-add-on-option-field.multi-default-field").hide())}},{key:"initialize_options",value:function(){return _(this,d),this.meta_box.find("button.js-add-option").on("click",this.add_option),this.meta_box.find("button.js-remove-options").on("click",this.delete_selected_options),a("#checkout-add-ons-options").sortable({axis:"y",handle:".js-checkout-add-on-option-sort-handle"})}},{key:"add_option",value:function(){var e,i,t;return _(this,d),t=a("#checkout-add-on-option--template"),i=this.get_next_option_index(),(e=t.clone().attr("id","")).find(".checkout-add-on-option-field").each(function(e,t){if(a(t).attr("name",a(t).attr("name").replace("template",i)),"default_option"===a(t).attr("name"))return a(t).attr("value",i)}),e.appendTo(a(t).closest("tbody")),this.updated_options()}},{key:"get_next_option_index",value:function(){return _(this,d),this.meta_box.find(".checkout-add-on-option-row:not(#checkout-add-on-option--template)").length}},{key:"delete_selected_options",value:function(){return _(this,d),this.meta_box.find(".checkout-add-on-option-row th.check-column input:checked").closest(".checkout-add-on-option-row").remove(),this.updated_options()}},{key:"enable_disable_attributes",value:function(){var o,e,n;return _(this,d),e=a("#type").val(),n=this.params.add_on_supported_attributes?this.params.add_on_supported_attributes[e]:[],(o=a("#attributes")).find("option").each(function(e,t){var i=void 0===n||-1===n.indexOf(t.value);return a(t).prop("disabled",i).prop("selected",a(t).prop("selected")&&!i),o.select2()})}},{key:"initialize_rules",value:function(){return _(this,d),this.initialize_product_or_category_rule(),this.initialize_other_add_on_rule()}},{key:"initialize_product_or_category_rule",value:function(){var e,t,i,o;return _(this,d),i=this.meta_box.find("select[id=product_ids]"),t=this.meta_box.find("select[id=category_ids]"),i.select2({placeholder:i.attr("placeholder")}),t.select2({placeholder:t.attr("placeholder")}),o=this.meta_box.find("#product_ids_wrapper"),e=this.meta_box.find("#category_ids_wrapper"),(t=this.meta_box.find("select[id=product_or_category_property]")).on("change",function(){return"category"===a(this).val()?(o.hide(),e.show()):(o.show(),e.hide())}),t.trigger("change")}},{key:"initialize_other_add_on_rule",value:function(){return _(this,d),a("#other_add_on_property").on("change",this.handle_other_add_on_changes),a("#other_add_on_operator").on("change",this.handle_other_add_on_changes),a("#other_add_on_operator").select2(),a("#other_add_on_select_value").select2(),a("#other_add_on_multiselect_value").select2()}},{key:"handle_other_add_on_changes",value:function(){var e,t,i,o=this;return _(this,d),e=a("#other_add_on_current_add_on_id").val(),i=a("#other_add_on_property").val(),t=a("#other_add_on_operator").val(),a.ajax({type:"POST",url:this.params.ajax_url,data:{action:"wc_checkout_add_ons_other_add_on_fields",security:this.params.display_rule_other_add_on_nonce,current_add_on_id:e,other_add_on_id:i,operator:t}}).done(function(e){return a(".checkout-add-on-rule-other_add_on").html(e.data),a("#other_add_on_operator").on("change",o.handle_other_add_on_changes),a("#other_add_on_operator").select2(),a("#other_add_on_select_value").select2(),a("#other_add_on_multiselect_value").select2()})}},{key:"handle_tab_selection",value:function(e){var t;return _(this,d),e.preventDefault(),!a(e.target).closest("li").hasClass("disabled")&&(t=a(e.target).closest("li"),e=a(a(e.target).attr("href")),this.meta_box.find(".panel").hide(),e.show(),this.meta_box.find(".wc-tab").removeClass("active"),t.addClass("active"))}}]),t);function t(e){_classCallCheck(this,t);e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return e.initialize_fields=e.initialize_fields.bind(e),e.add_on_type_changed=e.add_on_type_changed.bind(e),e.handle_field_exclusions=e.handle_field_exclusions.bind(e),e.handle_checkbox_default=e.handle_checkbox_default.bind(e),e.is_taxable_changed=e.is_taxable_changed.bind(e),e.disable_options=e.disable_options.bind(e),e.enable_options=e.enable_options.bind(e),e.updated_options=e.updated_options.bind(e),e.initialize_options=e.initialize_options.bind(e),e.add_option=e.add_option.bind(e),e.get_next_option_index=e.get_next_option_index.bind(e),e.delete_selected_options=e.delete_selected_options.bind(e),e.enable_disable_attributes=e.enable_disable_attributes.bind(e),e.initialize_rules=e.initialize_rules.bind(e),e.initialize_product_or_category_rule=e.initialize_product_or_category_rule.bind(e),e.initialize_other_add_on_rule=e.initialize_other_add_on_rule.bind(e),e.handle_other_add_on_changes=e.handle_other_add_on_changes.bind(e),e.handle_tab_selection=e.handle_tab_selection.bind(e),e.initialize_fields(),e.initialize_options(),e.initialize_rules(),e.meta_box.find("ul.wc-tabs>li a").on("click",e.handle_tab_selection).first().click(),e}})}.call(void 0);